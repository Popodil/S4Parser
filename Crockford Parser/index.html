<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<meta name="author" content="Douglas Crockford">
    <title>Top Down Operator Precedence</title>
    <style>
th {background-color: thistle; border: black solid 1px; text-align: left;
    padding-left: 10px; padding-right: 10px; vertical-align: top;}
td {background-color: white; border: black solid 1pt; padding-left: 10px;
    padding-right: 10px; vertical-align: top;}
table {width: 90%; border: 0px; cellpadding: 0px;}
    </style>
</head>

<body bgcolor="linen">
<h1>Top Down Operator Precedence</h1>

<p><a href="http://www.crockford.com/">Douglas Crockford</a></p>

<p>2007-08-05</p>

<h2>Demonstration</h2>
<p>This is the companion file to my paper on <a href="http://crockford.com/javascript/tdop/tdop.html">Vaughan
  Pratt's Top Down Operator Precedence</a>. The paper presents a parser
  for Simplified JavaScript that is written in Simplified Javascript. It
  is chapter 9 of <a href="http://www.amazon.com/exec/obidos/ASIN/0596510047/wrrrldwideweb">Beautiful
  Code</a>. This page loads that parser and runs the parser on itself. </p>
<p>This page loads two JavaScript files:</p>
<table border="0" align="center">
  <tbody><tr>
    <td valign="top"><a href="http://crockford.com/javascript/tdop/tokens.js">tokens.js</a></td>
    <td>This file installs the <code>tokenize</code> function. It
      produces an array of simple tokens from a string or array of strings.</td>
  </tr>
  <tr>
    <td valign="top"><a href="http://crockford.com/javascript/tdop/parse.js">parse.js</a></td>
    <td>This file installs the <code>make_parse</code> function which produces
      the parse function. The indirection was done so that we could conveniently
      recover the source of the function.</td>
  </tr>
</tbody></table>
<p>The text that follows is the parse tree that the parser generated by
  parsing itself. </p>
<textarea id="INPUT" style="
    border: 2px solid black;
    color: black;
    font-family: monospace;
    height: 3in;
    overflow: auto;
    padding: 0.5em;
    width: 100%;"></textarea>
<input id="PARSE" value="parse" type="button">
<noscript><p>You may not see it because you have JavaScript turned off. Uffff!</p></noscript>
<script src="Top%20Down%20Operator%20Precedence_bestanden/tokens.js"></script>
<script src="Top%20Down%20Operator%20Precedence_bestanden/parse.js"></script>
<pre id="OUTPUT"></pre>
<script>
/*jslint evil: true */

/*members create, error, getElementById, innerHTML, message, name,
    onclick, prototype, replace, stringify, toSource, toString, value
*/

/*global make_parse, parse, source, tree */

// Transform a token object into an exception object and throw it.

Object.prototype.error = function (message, t) {
    t = t || this;
    t.name = "SyntaxError";
    t.message = message;
    throw t;
};


(function () {
    let parse = make_parse();

    function go(source) {
        let string, tree;
        try {
            tree = parse(tokenize(source));
            string = JSON.stringify(
                tree,
                [
                    "key", "name", "message", "value", "arity",
                    "first", "second", "third", "fourth"
                ],
                4
            );
        } catch (e) {
            string = JSON.stringify(
                e,
                [
                    "name", "message", "line_nr", "column_nr", "key", "value",
                    "arity", "first", "second", "third", "fourth"
                ],
                4
            );
        }
        document.getElementById("OUTPUT").innerHTML = string
            .replace(/&/g, "&amp;")
            .replace(/[<]/g, "&lt;")
            .replace(/[>]/g, "&gt;");
    }

    go("let make_parse = "+ make_parse.toString() + ";");

    document.getElementById("PARSE").onclick = function (e) {
        go(document.getElementById("INPUT").value);
    };
}());

</script>


</body></html>